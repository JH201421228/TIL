# ShuffleNet

소유자: 주헌 박

# ShuffleNet 핵심 요약 (한눈에 보는 포인트)

## 무엇을 제안했나

- 모바일·임베디드(10–150 MFLOPs) 환경을 겨냥해, **Pointwise Group Convolution(1×1 그룹 합성곱)**과 **Channel Shuffle(채널 셔플)**을 결합한 초경량 CNN **ShuffleNet**을 제안. 동일 연산 예산에서 채널 수를 더 늘려 표현력을 확보한다. ImageNet/COCO에서 동급 대비 우수, ARM 디바이스 실측에서도 큰 가속을 보였다.

## 왜 필요한가 (문제의식)

- 최신 기본 블록(Xception, ResNeXt 등)도 **1×1 합성곱의 연산 비중이 과도**해, 극소형 네트워크에선 비효율적이다. 1×1에 **그룹 합성곱**을 적용하면 연산을 줄일 수 있지만, 그룹을 쌓으면 **그룹 간 정보 흐름이 끊기는 부작용**이 생긴다. 이를 **채널 셔플**로 해결해 그룹 간 특징이 섞이도록 했다.

## 어떻게 만들었나 (설계의 핵심)

- **ShuffleNet Unit**:
    1. 1×1 **그룹 합성곱** → 2) **채널 셔플** → 3) 3×3 **Depthwise Conv**(DW) → 4) 1×1 **그룹 합성곱**.
        
        Stride=2일 때는 지름길(쇼트컷)에 **3×3 AvgPool**을 넣고, 합은 **concatenation**으로 처리해 채널을 자연스럽게 늘린다.
        
- **연산 이득(대략식)**: 입력 (c\times h\times w), 병목 채널 (m), 그룹 수 (g)일 때,
    
    ResNet 유닛: (hw(2cm + 9m^2))
    
    ResNeXt: (hw(2cm + 9m^2/g))
    
    **ShuffleNet**: (hw(2cm/g + 9m))
    
    → 같은 예산에서 **ShuffleNet이 더 넓은(채널 많은) 특성맵을 사용**할 수 있어, 소형 모델일수록 이득이 크다.
    
- 실무 고려: DW 합성곱은 이론 연산량이 작아도 **모바일에서 메모리 접근 비율 때문에 비효율적일 수 있음**. 그래서 DW는 **병목 특징맵에서만** 사용해 오버헤드를 줄였다.

## 무엇이 효과였나 (실험·어블레이션)

- **Pointwise 그룹 합성곱의 이득**: g>1이 g=1(Xception-like)보다 항상 좋음. 작은 모델일수록(0.5×, 0.25×) **이득이 더 큼**. 너무 큰 g는 입력 채널이 너무 얇아져 포화·하락 가능(특히 0.5×에서 g=8).
- **채널 셔플의 이득**: 셔플을 끄면 정확도가 **유의하게 하락**. g가 클수록 셔플의 이점이 커짐(예: g=8에서 큰 향상).

## 다른 블록들과의 비교(같은 FLOPs 맞춰 비교)

- **VGG-like, ResNet, ResNeXt, Xception-like**와 동일 예산으로 비교 시, ShuffleNet이 전반적으로 **더 낮은 Top-1 오류**. 핵심 이유는 **같은 예산에 더 넓은 채널**을 확보하기 쉬운 구조이기 때문.

## MobileNet 등 타 경량 모델과의 정면승부

- ImageNet 단일크롭 기준:
    - **~500 MFLOPs급**: ShuffleNet 2×(g=3) **26.3%** vs MobileNet-1.0 **29.4%** → **3.1%p 개선**.
    - **~150 MFLOPs급**: ShuffleNet 1×(g=8) **32.4%** vs MobileNet-0.5 **36.3%** → **3.9%p 개선**.
    - **~40 MFLOPs급**: ShuffleNet 0.5×(g=4) **41.6%** vs MobileNet-0.25 **49.4%** → **7.8%p 개선**.
- **COCO 탐지(Faster R-CNN 백본)**: 비슷한 예산에서 ShuffleNet이 MobileNet보다 **mAP가 더 높음**(예: 524 vs 569 MFLOPs 구간).

## 실제 디바이스 성능(ARM, Snapdragon 820, 싱글 스레드)

- 이론 4× 경량화가 **실측에선 ~2.6× 가속** 정도로 나타나는 현실적 한계를 보고. 그럼에도 **ShuffleNet 0.5× ≈ AlexNet 정확도에서 약 13× 실측 가속**(이론 18×)을 달성. **경량 구조 설계는 “실측 속도”를 반드시 확인**해야 함을 강조.

## 한 줄 정리(Takeaways)

- **핵심 아이디어**: 1×1의 비용을 **그룹화**로 줄이고, 그룹으로 끊긴 정보흐름을 **채널 셔플**로 복구.
- **효과**: 같은 연산 예산에서 **더 넓은 채널 폭**을 확보 → 소형 모델에서 특히 큰 정확도 이득.
- **실무 팁**: DW는 병목에만, g는 **정확도–실속도** 균형상 **중간값(예: g≈3)**이 실전에서 유리.